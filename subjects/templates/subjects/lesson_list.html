<!-- templates/lesson_list.html -->
{% extends 'base.html' %}

{% block content %}
<h1>Lessons</h1>
<form id="lessonForm">
    <label for="group_name">Group Name:</label>
    <input type="text" id="group_name" name="group_name" required><br>
    <label for="subject">Subject:</label>
    <select id="subject" name="subject_id"></select><br>
    <label for="teacher">Teacher:</label>
    <select id="teacher" name="teacher_id"></select><br>
    <label for="group_template">Group Template:</label>
    <select id="group_template" name="group_template_id"></select><br>
    <button type="submit">Add Lesson</button>
</form>

<ul id="lessonList"></ul>

<script>
document.getElementById('lessonForm').addEventListener('submit', function(e) {
    e.preventDefault();
    var groupName = document.getElementById('group_name').value;
    var subjectId = document.getElementById('subject').value;
    var teacherId = document.getElementById('teacher').value;
    var groupTemplateId = document.getElementById('group_template').value;

    fetch('{% url "lesson-list" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Token ' + 'YOUR_TOKEN_HERE'
        },
        body: JSON.stringify({
            group_name: groupName,
            subject: subjectId,
            teacher: teacherId,
            group_template: groupTemplateId
        })
    }).then(response => response.json())
      .then(data => {
        console.log(data);
        loadLessons();
    });
});

function populateDropdowns() {
    // Fetch and populate the dropdown for subjects
    fetch('{% url "subject-list" %}', {
        headers: {'Authorization': 'Token ' + 'YOUR_TOKEN_HERE'}
    }).then(response => response.json())
      .then(data => {
        var select = document.getElementById('subject');
        data.forEach(function(subject) {
            var option = document.createElement('option');
            option.value = subject.id;
            option.textContent = subject.name;
            select.appendChild(option);
        });
    });

    // Repeat for teachers and group templates
    // Replace 'teacher-list-url' and 'grouptemplate-list-url' with actual URLs
}

function loadLessons() {
    fetch('{% url "lesson-list" %}', {
        headers: {'Authorization': 'Token ' + 'YOUR_TOKEN_HERE'}
    }).then(response => response.json())
      .then(data => {
        var list = document.getElementById('lessonList');
        list.innerHTML = '';
        data.forEach(function(lesson) {
            var item = document.createElement('li');
            item.textContent = `${lesson.group_name} - ${lesson.subject.name} by ${lesson.teacher.full_name}`;
            list.appendChild(item);
        });
    });
}

window.onload = function() {
    populateDropdowns();
    loadLessons();
};
</script>
{% endblock %}
