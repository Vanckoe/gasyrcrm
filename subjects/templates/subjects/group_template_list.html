{% block content %}
<h1>Create Group Template</h1>

<!-- Display existing group templates -->
<h2>Existing Group Templates</h2>
<ul>
    {% for gt in group_templates %}
        <li>{{ gt.name }}</li>
    {% endfor %}
</ul>

<!-- Form for creating a group template and selecting students -->
<form id="group-template-form" method="post" action="">
    {% csrf_token %}
    {{ form.as_p }}  <!-- Form for the group template name -->
    {{ search_form.as_p }}  <!-- Form for searching students -->
    <label for="selected_students">Select Students:</label>
    <select name="selected_students" id="selected_students" multiple size="10">
        {% for student in students %}
            <option value="{{ student.id }}">{{ student.full_name }}</option>
        {% endfor %}
    </select>
    <button type="submit" name="create_template">Create Group Template</button>
    <button type="button" onclick="searchStudents()">Search</button>
</form>

<script>
function searchStudents() {
    var searchInput = document.querySelector('[name="search"]').value;
    var url = '{% url "subjects:search-students" %}?search=' + searchInput;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            var select = document.getElementById('selected_students');
            select.innerHTML = '';  // Clear existing options
            if (Array.isArray(data)) {  // Ensure data is an array
                data.forEach(student => {
                    var option = new Option(student.full_name, student.id);  // Simplified option creation
                    select.add(option);
                });
            } else {
                console.error('Received data is not an array:', data);
            }
        })
        .catch(error => console.error('Error:', error));
}
</script>

{% endblock %}
