{% load static %}
<div class="h-side w-[25%] flex flex-col pt-[60px] p-5 bg-white">
    <div class="mb-auto">
        {% for module in course.modules.all %}
            <div class="relative overflow-hidden mb-4">
                {% if module_id == module.id %}
                    <div class="bg-white rounded-lg text-accent-red text-start font-bold px-6">
                        <img class="inline-block mr-3"
                             src="{% static "core/icons/folder-fill-accent-red.svg" %}" alt="">
                        <span class="mr-auto">Модуль {{ forloop.counter }}</span>
                    </div>
                    <img class="absolute right-6 top-0 block h-[24px]"
                         src="{% static "core/icons/arrow-right-button-accent-red.svg" %}" alt="">
                {% else %}
                    <a href="{% url 'courses:module_detail' pk=module.id %}">
                        <div class="bg-white rounded-lg text-start font-bold px-6">
                            <img class="inline-block mr-3"
                                 src="{% static "core/icons/folder-fill-black-main.svg" %}" alt="">
                            <span class="mr-auto">Модуль {{ forloop.counter }}</span>
                        </div>
                        <img class="absolute right-6 top-0 block h-[24px] -rotate-90"
                             src="{% static "core/icons/arrow-down-button-gray.svg" %}" alt="">
                    </a>
                {% endif %}
            </div>
        {% endfor %}
    </div>
<a id="add-module-button" href="javascript:void(0);" class="text-center border border-accent-red rounded-lg font-semibold text-accent-red py-5">
    <img class="inline-block pr-[23px]" src="{% static 'core/icons/add-circle-accent-red.svg' %}" alt="">Добавить модуль
</a>
    <div id="new-module-form" style="display:none;" class="p-4 border-t border-gray-300">
    <input type="text" id="module-name" class="border py-2 px-4 border-gray-300 rounded-lg w-full" placeholder="Название модуля">
    <button onclick="createModule()" class="mt-3 w-full bg-accent-red text-white py-2 rounded-lg">Создать</button>
</div>

</div>

<script>
// Function to calculate the next module name based on existing ones
function getNextModuleName() {
    const existingModules = document.querySelectorAll('.module-link');
    const lastModuleNumber = existingModules.length;
    const nextModuleNumber = lastModuleNumber + 1;
    return 'Модуль ' + nextModuleNumber;
}

// Function to create a new module
function createModule() {
    const moduleName = getNextModuleName(); // Get the next module name
    const formData = new FormData();
    formData.append('module_name', moduleName);
    formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

    fetch("{% url 'courses:module_create' course_id=course.id %}", {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': '{{ csrf_token }}',
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert("Error: " + JSON.stringify(data.error));
        } else {
            // Module was created successfully, reload to show new module
            window.location.reload();
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to add module');
    });
}

// Automatically create a new module when the add button is clicked
document.getElementById('add-module-button').addEventListener('click', createModule);
</script>