{% extends 'core/base.html' %}

{% block content %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<h2>Edit Test: {{ test.title }}</h2>

<form method="post" action="">
    {% csrf_token %}
    <label for="title">Test Title:</label>
    <input type="text" id="title" name="title" value="{{ test.title }}" required><br><br>

    <div id="questionsContainer">
        {% for question in test.questions.all %}
            <div class="question">
                <label for="question_{{ forloop.counter0 }}">Question:</label>
                <input type="text" id="question_{{ forloop.counter0 }}" name="questions[{{ forloop.counter0 }}][text]" value="{{ question.text }}" required>
                <!-- Add fields for answer options here -->
            </div>
        {% endfor %}
    </div>

    <!-- Hidden input to keep track of question count -->
    <input type="hidden" id="questionCount" value="{{ test.questions.all.count }}">

    <button type="button" id="addQuestion">Add Question</button>
    <br><br>
    <input type="submit" value="Edit Test">
</form>

<script>
$(document).ready(function() {
    let questionCount = parseInt($('#questionCount').val()) || 0;

    $('#addQuestion').click(function(e) {
        e.preventDefault();
        let questionHTML = `
            <div class="question" data-index="${questionCount}">
                <label>Question:</label>
                <input type="text" name="questions[${questionCount}][text]" required>
                <label>Question Type:</label>
                <select name="questions[${questionCount}][type]">
                    <option value="SC">Single Choice</option>
                    <option value="MC">Multiple Choice</option>
                </select>
                <div class="answers">` +
                Array.from({ length: 4 }, (_, i) => `
                    <div class="answer">
                        <label>Answer ${i + 1}:</label>
                        <input type="text" name="questions[${questionCount}][answers][${i}][text]" required>
                        <label>Correct:</label>
                        <input type="checkbox" name="questions[${questionCount}][answers][${i}][is_correct]">
                    </div>
                `).join('') + `
                </div>
            </div>`;

        $('#questionsContainer').append(questionHTML);
        $('html, body').animate({ scrollTop: $(`div[data-index="${questionCount}"]`).offset().top }, 'slow');
        questionCount++;
        $('#questionCount').val(questionCount);
    });
});
</script>

{% endblock %}
