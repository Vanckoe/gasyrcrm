<!-- create_test.html -->
{% extends 'core/base.html' %}

{% block content %}
<h2>Create Test for {{ parent_object }}</h2>

<form method="post" action="">
    {% csrf_token %}
    <label for="title">Test Title:</label>
    <input type="text" id="title" name="title" required><br><br>

    <div id="questionsContainer">
        <!-- JavaScript will append questions here -->
    </div>

    <button type="button" id="addQuestion">Add Question</button>
    <br><br>
    <input type="submit" value="Create Test">
</form>

<script>
$(document).ready(function() {
    let questionCount = parseInt($('#questionCount').val());

    $('#addQuestion').click(function(e) {
        e.preventDefault();
        let questionHTML = `
            <div class="question" data-index="${questionCount}">
                <label>Question:</label>
                <input type="text" name="questions[${questionCount}][text]" required>
                <label>Question Type:</label>
                <select name="questions[${questionCount}][type]">
                    <option value="SC">Single Choice</option>
                    <option value="MC">Multiple Choice</option>
                </select>
                <div class="answers">` +
                Array.from({ length: 4 }, (_, i) => `
                    <div class="answer">
                        <label>Answer ${i + 1}:</label>
                        <input type="text" name="questions[${questionCount}][answers][${i}][text]" required>
                        <label>Correct:</label>
                        <input type="checkbox" name="questions[${questionCount}][answers][${i}][is_correct]">
                    </div>
                `).join('') + `
                </div>
            </div>`;

        $('#questionsContainer').append(questionHTML);
        $('html, body').animate({ scrollTop: $(`div[data-index="${questionCount}"]`).offset().top }, 'slow');
        questionCount++;
        $('#questionCount').val(questionCount);
    });
});
</script>

{% endblock %}
